{"version":3,"file":"sifter.js","sources":["../../lib/diacritics.ts","../../lib/utils.ts","../../lib/sifter.ts"],"sourcesContent":["\ntype TDiacraticList = {[key:string]:string};\n\n// https://github.com/andrewrk/node-diacritics/blob/master/index.js\n\nvar latin_pat:RegExp;\nconst accent_pat = '[\\u0300-\\u036F\\u{b7}\\u{2be}]'; // \\u{2bc}\nconst accent_reg = new RegExp(accent_pat,'g');\nvar diacritic_patterns:TDiacraticList;\n\nconst latin_convert:TDiacraticList = {\n\t'æ': 'ae',\n\t'ⱥ': 'a',\n\t'ø': 'o',\n};\n\nconst convert_pat = new RegExp(Object.keys(latin_convert).join('|'),'g');\n\n\nexport const DIACRITICS:TDiacraticList = {\n\t\" \":\" \",\n\t0:\"߀\",\n\tA:\"ⒶＡÀÁÂẦẤẪẨÃĀĂẰẮẴẲȦǠÄǞẢÅǺǍȀȂẠẬẶḀĄȺⱯ\",\n\tAA:\"Ꜳ\",\n\tAE:\"ÆǼǢ\",\n\tAO:\"Ꜵ\",\n\tAU:\"Ꜷ\",\n\tAV:\"ꜸꜺ\",\n\tAY:\"Ꜽ\",\n\tB:\"ⒷＢḂḄḆɃƁ\",\n\tC:\"ⒸＣꜾḈĆCĈĊČÇƇȻ\",\n\tD:\"ⒹＤḊĎḌḐḒḎĐƊƉᴅꝹ\",\n\tDh:\"Ð\",\n\tDZ:\"ǱǄ\",\n\tDz:\"ǲǅ\",\n\tE:\"ɛⒺＥÈÉÊỀẾỄỂẼĒḔḖĔĖËẺĚȄȆẸỆȨḜĘḘḚƐƎᴇ\",\n\tF:\"ꝼⒻＦḞƑꝻ\",\n\tG:\"ⒼＧǴĜḠĞĠǦĢǤƓꞠꝽꝾɢ\",\n\tH:\"ⒽＨĤḢḦȞḤḨḪĦⱧⱵꞍ\",\n\tI:\"ⒾＩÌÍÎĨĪĬİÏḮỈǏȈȊỊĮḬƗ\",\n\tJ:\"ⒿＪĴɈȷ\",\n\tK:\"ⓀＫḰǨḲĶḴƘⱩꝀꝂꝄꞢ\",\n\tL:\"ⓁＬĿĹĽḶḸĻḼḺŁȽⱢⱠꝈꝆꞀ\",\n\tLJ:\"Ǉ\",\n\tLj:\"ǈ\",\n\tM:\"ⓂＭḾṀṂⱮƜϻ\",\n\tN:\"ꞤȠⓃＮǸŃÑṄŇṆŅṊṈƝꞐᴎ\",\n\tNJ:\"Ǌ\",\n\tNj:\"ǋ\",\n\tO:\"ⓄＯÒÓÔỒỐỖỔÕṌȬṎŌṐṒŎȮȰÖȪỎŐǑȌȎƠỜỚỠỞỢỌỘǪǬØǾƆƟꝊꝌ\",\n\tOE:\"Œ\",\n\tOI:\"Ƣ\",\n\tOO:\"Ꝏ\",\n\tOU:\"Ȣ\",\n\tP:\"ⓅＰṔṖƤⱣꝐꝒꝔ\",\n\tQ:\"ⓆＱꝖꝘɊ\",\n\tR:\"ⓇＲŔṘŘȐȒṚṜŖṞɌⱤꝚꞦꞂ\",\n\tS:\"ⓈＳẞŚṤŜṠŠṦṢṨȘŞⱾꞨꞄ\",\n\tT:\"ⓉＴṪŤṬȚŢṰṮŦƬƮȾꞆ\",\n\tTh:\"Þ\",\n\tTZ:\"Ꜩ\",\n\tU:\"ⓊＵÙÚÛŨṸŪṺŬÜǛǗǕǙỦŮŰǓȔȖƯỪỨỮỬỰỤṲŲṶṴɄ\",\n\tV:\"ⓋＶṼṾƲꝞɅ\",\n\tVY:\"Ꝡ\",\n\tW:\"ⓌＷẀẂŴẆẄẈⱲ\",\n\tX:\"ⓍＸẊẌ\",\n\tY:\"ⓎＹỲÝŶỸȲẎŸỶỴƳɎỾ\",\n\tZ:\"ⓏＺŹẐŻŽẒẔƵȤⱿⱫꝢ\",\n\ta:\"ⓐａẚàáâầấẫẩãāăằắẵẳȧǡäǟảåǻǎȁȃạậặḁąⱥɐɑ\",\n\taa:\"ꜳ\",\n\tae:\"æǽǣ\",\n\tao:\"ꜵ\",\n\tau:\"ꜷ\",\n\tav:\"ꜹꜻ\",\n\tay:\"ꜽ\",\n\tb:\"ⓑｂḃḅḇƀƃɓƂ\",\n\tc:\"ｃⓒćĉċčçḉƈȼꜿↄ\",\n\td:\"ⓓｄḋďḍḑḓḏđƌɖɗƋᏧԁꞪ\",\n\tdh:\"ð\",\n\tdz:\"ǳǆ\",\n\te:\"ⓔｅèéêềếễểẽēḕḗĕėëẻěȅȇẹệȩḝęḙḛɇǝ\",\n\tf:\"ⓕｆḟƒ\",\n\tff:\"ﬀ\",\n\tfi:\"ﬁ\",\n\tfl:\"ﬂ\",\n\tffi:\"ﬃ\",\n\tffl:\"ﬄ\",\n\tg:\"ⓖｇǵĝḡğġǧģǥɠꞡꝿᵹ\",\n\th:\"ⓗｈĥḣḧȟḥḩḫẖħⱨⱶɥ\",\n\thv:\"ƕ\",\n\ti:\"ⓘｉìíîĩīĭïḯỉǐȉȋịįḭɨı\",\n\tj:\"ⓙｊĵǰɉ\",\n\tk:\"ⓚｋḱǩḳķḵƙⱪꝁꝃꝅꞣ\",\n\tl:\"ⓛｌŀĺľḷḹļḽḻſłƚɫⱡꝉꞁꝇɭ\",\n\tlj:\"ǉ\",\n\tm:\"ⓜｍḿṁṃɱɯ\",\n\tn:\"ⓝｎǹńñṅňṇņṋṉƞɲŉꞑꞥлԉ\",\n\tnj:\"ǌ\",\n\to:\"ⓞｏòóôồốỗổõṍȭṏōṑṓŏȯȱöȫỏőǒȍȏơờớỡởợọộǫǭøǿꝋꝍɵɔᴑ\",\n\toe:\"œ\",\n\toi:\"ƣ\",\n\too:\"ꝏ\",\n\tou:\"ȣ\",\n\tp:\"ⓟｐṕṗƥᵽꝑꝓꝕρ\",\n\tq:\"ⓠｑɋꝗꝙ\",\n\tr:\"ⓡｒŕṙřȑȓṛṝŗṟɍɽꝛꞧꞃ\",\n\ts:\"ⓢｓśṥŝṡšṧṣṩșşȿꞩꞅẛʂ\",\n\tss:\"ß\",\n\tt:\"ⓣｔṫẗťṭțţṱṯŧƭʈⱦꞇ\",\n\tth:\"þ\",\n\ttz:\"ꜩ\",\n\tu:\"ⓤｕùúûũṹūṻŭüǜǘǖǚủůűǔȕȗưừứữửựụṳųṷṵʉ\",\n\tv:\"ⓥｖṽṿʋꝟʌ\",\n\tvy:\"ꝡ\",\n\tw:\"ⓦｗẁẃŵẇẅẘẉⱳ\",\n\tx:\"ⓧｘẋẍ\",\n\ty:\"ⓨｙỳýŷỹȳẏÿỷẙỵƴɏỿ\",\n\tz:\"ⓩｚźẑżžẓẕƶȥɀⱬꝣ\"\n}\n\n/**\n * code points generated from toCodePoints();\n * removed 65339 to 65345\n */\nexport const code_points = [\n\t[ 67, 67 ],\n\t[ 160, 160 ],\n\t[ 192, 438 ],\n\t[ 452, 652 ],\n\t[ 961, 961 ],\n\t[ 1019, 1019 ],\n\t[ 1083, 1083 ],\n\t[ 1281, 1289 ],\n\t[ 1984, 1984 ],\n\t[ 5095, 5095 ],\n\t[ 7429, 7441 ],\n\t[ 7545, 7549 ],\n\t[ 7680, 7935 ],\n\t[ 8580, 8580 ],\n\t[ 9398, 9449 ],\n\t[ 11360, 11391 ],\n\t[ 42792, 42793 ],\n\t[ 42802, 42851 ],\n\t[ 42873, 42897 ],\n\t[ 42912, 42922 ],\n\t[ 64256, 64260 ],\n\t[ 65313, 65338 ],\n\t[ 65345, 65370 ]\n];\n\n/**\n * Remove accents\n * via https://github.com/krisk/Fuse/issues/133#issuecomment-318692703\n *\n */\nexport const asciifold = (str:string):string => {\n\treturn str\n\t\t.normalize('NFKD')\n\t\t.replace(accent_reg, '')\n\t\t.toLowerCase()\n\t\t.replace(convert_pat,function(foreignletter) {\n\t\t\treturn latin_convert[foreignletter];\n\t\t});\n};\n\n\n/**\n * Convert list of diacritics to array of code points\n *\n */\n// @ts-ignore\nfunction toCodePoints(tolerance=8){\n\tvar char_codes:number[] = [];\n\n\tfor( let letter in DIACRITICS ){\n\t\tlet _diacritics = DIACRITICS[letter];\n\t\tfor( let n = 0; n < _diacritics.length; n++ ){\n\t\t\tvar code_point = _diacritics.codePointAt(n);\n\t\t\tif( code_point ) char_codes.push( code_point );\n\t\t}\n\t}\n\n\t//https://stackoverflow.com/questions/40431572/is-there-a-simple-way-to-group-js-array-values-by-range\n\tchar_codes.sort((a, b) => a - b);\n\tvar accumulator: number[][] = [];\n\tchar_codes.reduce(function (accumulator, currentValue, index, source) {\n\n\t\tif( !index ){\n\t\t\taccumulator.push( [currentValue,currentValue] );\n\n\t\t}else if( currentValue - source[index - 1] > tolerance ){\n\t\t\taccumulator.push( [currentValue,currentValue] );\n\n\t\t}else{\n\n\t\t\tlet range = accumulator.pop();\n\t\t\tif( range ){\n\t\t\t\taccumulator.push( [range[0],currentValue]);\n\t\t\t}\n\t\t}\n\n\t\treturn accumulator;\n\t}, accumulator);\n\n}\n\n/**\n * Convert array of strings to a regular expression\n *\tex ['ab','a'] => (?:ab|a)\n * \tex ['a','b'] => [ab]\n *\n */\nexport const arrayToPattern = (chars:string[],glue:string='|'):string =>{\n\t\n\tif( chars.length == 1 ){\n\t\treturn chars[0];\n\t}\n\t\n\tvar longest = 1;\n\tchars.forEach((a)=>{longest = Math.max(longest,a.length)});\n\n\tif( longest == 1 ){\n\t\treturn '['+chars.join('')+']';\n\t}\n\n\treturn '(?:'+chars.join(glue)+')';\t\n};\n\n/**\n * Get all possible combinations of substrings that add up to the given string\n * https://stackoverflow.com/questions/30169587/find-all-the-combination-of-substrings-that-add-up-to-the-given-string\n *\n */\nexport const allSubstrings = (input:string):string[][] => {\n\n    if( input.length === 1) return [[input]];\n\n    var result:string[][] = [];\n    allSubstrings(input.substring(1)).forEach(function(subresult) {\n        var tmp = subresult.slice(0);\n        tmp[0] = input.charAt(0) + tmp[0];\n        result.push(tmp);\n\n        tmp = subresult.slice(0);\n        tmp.unshift(input.charAt(0));\n        result.push(tmp);\n    });\n    \n    return result;\n}\n\n/**\n * Generate a list of diacritics from the list of code points\n *\n */\nexport const generateDiacritics = ():TDiacraticList => {\t\n\n\tvar diacritics:{[key:string]:string[]} = {};\n\tcode_points.forEach((code_range)=>{\n\n\t\tfor(let i = code_range[0]; i <= code_range[1]; i++){\n\t\t\t\n\t\t\tlet diacritic\t= String.fromCharCode(i);\n\t\t\tlet\tlatin\t\t= asciifold(diacritic);\n\n\t\t\tif( latin == diacritic.toLowerCase() ){\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif( !(latin in diacritics) ){\n\t\t\t\tdiacritics[latin] = [latin];\n\t\t\t}\n\t\t\t\n\t\t\tvar patt = new RegExp( arrayToPattern(diacritics[latin]),'iu');\n\t\t\tif( diacritic.match(patt) ){\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t\n\t\t\tdiacritics[latin].push(diacritic);\n\t\t}\n\t});\n\t\t\n\tvar latin_chars = Object.keys(diacritics);\n\t\n\t\n\t// latin character pattern\n\t// match longer substrings first\n\tlatin_chars\t\t= latin_chars.sort((a, b) => b.length - a.length );\n\tlatin_pat\t\t= new RegExp('('+ arrayToPattern(latin_chars) + accent_pat + '*)','g');\n\t\n\t\n\t// build diacritic patterns\n\t// ae needs: \n\t//\t(?:(?:ae|Æ|Ǽ|Ǣ)|(?:A|Ⓐ|Ａ...)(?:E|ɛ|Ⓔ...))\n\tvar diacritic_patterns:TDiacraticList = {};\n\tlatin_chars.sort((a,b) => a.length -b.length).forEach((latin)=>{\n\t\t\n\t\tvar substrings\t= allSubstrings(latin);\n\t\tvar pattern = substrings.map((sub_pat)=>{\n\t\t\t\n\t\t\tsub_pat = sub_pat.map((l)=>{\n\t\t\t\tif( diacritics.hasOwnProperty(l) ){\n\t\t\t\t\treturn arrayToPattern(diacritics[l]);\n\t\t\t\t}\n\t\t\t\treturn l;\n\t\t\t});\n\t\t\t\n\t\t\treturn arrayToPattern(sub_pat,'');\n\t\t});\n\t\t\n\t\tdiacritic_patterns[latin] = arrayToPattern(pattern);\t\t\n\t});\n\t\t\t\n\treturn diacritic_patterns;\n}\n\n/**\n * Expand a regular expression pattern to include diacritics\n * \teg /a/ becomes /aⓐａẚàáâầấẫẩãāăằắẵẳȧǡäǟảåǻǎȁȃạậặḁąⱥɐɑAⒶＡÀÁÂẦẤẪẨÃĀĂẰẮẴẲȦǠÄǞẢÅǺǍȀȂẠẬẶḀĄȺⱯ/\n *\n */\nexport const diacriticRegexPoints = (regex:string):string => {\n\n\tif( diacritic_patterns === undefined ){\n\t\tdiacritic_patterns = generateDiacritics();\n\t}\n\t\n\tconst decomposed\t\t= regex.normalize('NFKD').toLowerCase();\n\t\n\treturn decomposed.split(latin_pat).map((part:string)=>{\n\t\t\n\t\tif( part == '' ){\n\t\t\treturn '';\n\t\t}\n\t\t\n\t\t// \"ﬄ\" or \"ffl\"\n\t\tconst no_accent = asciifold(part);\t\t\t\t\n\t\tif( diacritic_patterns.hasOwnProperty(no_accent) ){\n\t\t\treturn diacritic_patterns[no_accent];\n\t\t}\n\t\t\n\t\t// 'أهلا' (\\u{623}\\u{647}\\u{644}\\u{627}) or 'أهلا' (\\u{627}\\u{654}\\u{647}\\u{644}\\u{627})\n\t\tconst composed_part = part.normalize('NFC');\n\t\tif( composed_part != part ){\n\t\t\treturn arrayToPattern([part,composed_part]);\n\t\t}\n\t\t\t\t\n\t\treturn part;\n\t}).join('');\n\t\n}\n","\n// @ts-ignore TS2691 \"An import path cannot end with a '.ts' extension\"\nimport { asciifold } from './diacritics.ts';\n\n// @ts-ignore TS2691 \"An import path cannot end with a '.ts' extension\"\nimport * as T from './types.ts';\n\n\n/**\n * A property getter resolving dot-notation\n * @param  {Object}  obj     The root object to fetch property on\n * @param  {String}  name    The optionally dotted property name to fetch\n * @return {Object}          The resolved property value\n */\nexport const getAttr = (obj:{[key:string]:any}, name:string ) => {\n    if (!obj ) return;\n    return obj[name];\n};\n\n/**\n * A property getter resolving dot-notation\n * @param  {Object}  obj     The root object to fetch property on\n * @param  {String}  name    The optionally dotted property name to fetch\n * @return {Object}          The resolved property value\n */\nexport const getAttrNesting = (obj:{[key:string]:any}, name:string ) => {\n    if (!obj ) return;\n    var part, names = name.split(\".\");\n\twhile( (part = names.shift()) && (obj = obj[part]));\n    return obj;\n};\n\n/**\n * Calculates how close of a match the\n * given value is against a search token.\n *\n */\nexport const scoreValue = (value:string, token:T.Token, weight:number ):number => {\n\tvar score, pos;\n\n\tif (!value) return 0;\n\n\tvalue = value + '';\n\tpos = value.search(token.regex);\n\tif (pos === -1) return 0;\n\n\tscore = token.string.length / value.length;\n\tif (pos === 0) score += 0.5;\n\n\treturn score * weight;\n};\n\n/**\n *\n * https://stackoverflow.com/questions/63006601/why-does-u-throw-an-invalid-escape-error\n */\nexport const escape_regex = (str:string):string => {\t\n\treturn (str + '').replace(/([\\$\\(\\)\\*\\+\\.\\?\\[\\]\\^\\{\\|\\}\\\\])/gu, '\\\\$1');\n};\n\n\n/**\n * Cast object property to an array if it exists and has a value\n *\n */\nexport const propToArray = (obj:{[key:string]:any}, key:string) => {\n\tvar value = obj[key];\n\tif( value && !Array.isArray(value) ){\n\t\tobj[key] = [value];\n\t}\n}\n\n\n/**\n * Iterates over arrays and hashes.\n *\n * ```\n * iterate(this.items, function(item, id) {\n *    // invoked for each item\n * });\n * ```\n *\n */\nexport const iterate = (object:[]|{[key:string]:any}, callback:(value:any,key:number|string)=>any) => {\n\n\tif ( Array.isArray(object)) {\n\t\tobject.forEach(callback);\n\n\t}else{\n\n\t\tfor (var key in object) {\n\t\t\tif (object.hasOwnProperty(key)) {\n\t\t\t\tcallback(object[key], key);\n\t\t\t}\n\t\t}\n\t}\n};\n\n\n\nexport const cmp = (a:number|string, b:number|string) => {\n\tif (typeof a === 'number' && typeof b === 'number') {\n\t\treturn a > b ? 1 : (a < b ? -1 : 0);\n\t}\n\ta = asciifold(a + '').toLowerCase();\n\tb = asciifold(b + '').toLowerCase();\n\tif (a > b) return 1;\n\tif (b > a) return -1;\n\treturn 0;\n};\n","/**\n * sifter.js\n * Copyright (c) 2013–2020 Brian Reavis & contributors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this\n * file except in compliance with the License. You may obtain a copy of the License at:\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF\n * ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n *\n * @author Brian Reavis <brian@thirdroute.com>\n */\n\n // @ts-ignore TS2691 \"An import path cannot end with a '.ts' extension\"\nimport { scoreValue, getAttr, getAttrNesting, escape_regex, propToArray, iterate, cmp } from './utils.ts';\n// @ts-ignore TS2691 \"An import path cannot end with a '.ts' extension\"\nimport { diacriticRegexPoints } from './diacritics.ts';\n// @ts-ignore TS2691 \"An import path cannot end with a '.ts' extension\"\nimport * as T from 'types.ts';\n\nexport default class Sifter{\n\n\tpublic items; // []|{};\n\tpublic settings: T.Settings;\n\n\t/**\n\t * Textually searches arrays and hashes of objects\n\t * by property (or multiple properties). Designed\n\t * specifically for autocomplete.\n\t *\n\t */\n\tconstructor(items:any, settings:T.Settings) {\n\t\tthis.items = items;\n\t\tthis.settings = settings || {diacritics: true};\n\t};\n\n\t/**\n\t * Splits a search string into an array of individual\n\t * regexps to be used to match results.\n\t *\n\t */\n\ttokenize(query:string, respect_word_boundaries?:boolean, weights?:T.Weights ):T.Token[] {\n\t\tif (!query || !query.length) return [];\n\n\t\tconst tokens:T.Token[]\t= [];\n\t\tconst words\t\t\t\t= query.split(/\\s+/);\n\t\tvar field_regex:RegExp;\n\n\t\tif( weights ){\n\t\t\tfield_regex = new RegExp( '^('+ Object.keys(weights).map(escape_regex).join('|')+')\\:(.*)$');\n\t\t}\n\n\t\twords.forEach((word:string) => {\n\t\t\tlet field_match;\n\t\t\tlet field:null|string\t= null;\n\t\t\tlet regex:null|string\t= null;\n\n\t\t\t// look for \"field:query\" tokens\n\t\t\tif( field_regex && (field_match = word.match(field_regex)) ){\n\t\t\t\tfield\t= field_match[1];\n\t\t\t\tword\t= field_match[2];\n\t\t\t}\n\n\t\t\tif( word.length > 0 ){\n\t\t\t\tregex = escape_regex(word);\n\t\t\t\tif( this.settings.diacritics ){\n\t\t\t\t\tregex = diacriticRegexPoints(regex);\n\t\t\t\t}\n\t\t\t\tif( respect_word_boundaries ) regex = \"\\\\b\"+regex;\n\t\t\t}\n\n\t\t\ttokens.push({\n\t\t\t\tstring : word,\n\t\t\t\tregex  : regex ? new RegExp(regex,'iu') : null,\n\t\t\t\tfield  : field,\n\t\t\t});\n\t\t});\n\n\t\treturn tokens;\n\t};\n\n\n\t/**\n\t * Returns a function to be used to score individual results.\n\t *\n\t * Good matches will have a higher score than poor matches.\n\t * If an item is not a match, 0 will be returned by the function.\n\t *\n\t * @returns {function}\n\t */\n\tgetScoreFunction(query:string, options:T.Options ){\n\t\tvar search = this.prepareSearch(query, options);\n\t\treturn this._getScoreFunction(search);\n\t}\n\n\t_getScoreFunction(search:T.PrepareObj ){\n\t\tconst tokens\t\t= search.tokens,\n\t\ttoken_count\t\t\t= tokens.length;\n\n\t\tif (!token_count) {\n\t\t\treturn function() { return 0; };\n\t\t}\n\n\t\tconst fields\t= search.options.fields,\n\t\tweights\t\t\t= search.weights,\n\t\tfield_count\t\t= fields.length,\n\t\tgetAttrFn\t\t= search.getAttrFn;\n\n\t\tif (!field_count) {\n\t\t\treturn function() { return 1; };\n\t\t}\n\n\n\t\t/**\n\t\t * Calculates the score of an object\n\t\t * against the search query.\n\t\t *\n\t\t */\n\t\tconst scoreObject = (function() {\n\n\n\t\t\tif (field_count === 1) {\n\t\t\t\treturn function(token:T.Token, data:{}) {\n\t\t\t\t\tconst field = fields[0].field;\n\t\t\t\t\treturn scoreValue(getAttrFn(data, field), token, weights[field]);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn function(token:T.Token, data:{}) {\n\t\t\t\tvar sum = 0;\n\n\t\t\t\t// is the token specific to a field?\n\t\t\t\tif( token.field ){\n\n\t\t\t\t\tconst value = getAttrFn(data, token.field);\n\n\t\t\t\t\tif( !token.regex && value ){\n\t\t\t\t\t\tsum += (1/field_count);\n\t\t\t\t\t}else{\n\t\t\t\t\t\tsum += scoreValue(value, token, 1);\n\t\t\t\t\t}\n\n\n\n\t\t\t\t}else{\n\t\t\t\t\titerate(weights, (weight:number, field:string) => {\n\t\t\t\t\t\tsum += scoreValue(getAttrFn(data, field), token, weight);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn sum / field_count;\n\t\t\t};\n\t\t})();\n\n\t\tif (token_count === 1) {\n\t\t\treturn function(data:{}) {\n\t\t\t\treturn scoreObject(tokens[0], data);\n\t\t\t};\n\t\t}\n\n\t\tif (search.options.conjunction === 'and') {\n\t\t\treturn function(data:{}) {\n\t\t\t\tvar i = 0, score, sum = 0;\n\t\t\t\tfor (; i < token_count; i++) {\n\t\t\t\t\tscore = scoreObject(tokens[i], data);\n\t\t\t\t\tif (score <= 0) return 0;\n\t\t\t\t\tsum += score;\n\t\t\t\t}\n\t\t\t\treturn sum / token_count;\n\t\t\t};\n\t\t} else {\n\t\t\treturn function(data:{}) {\n\t\t\t\tvar sum = 0;\n\t\t\t\titerate(tokens,(token:T.Token)=>{\n\t\t\t\t\tsum += scoreObject(token, data);\n\t\t\t\t});\n\t\t\t\treturn sum / token_count;\n\t\t\t};\n\t\t}\n\t};\n\n\t/**\n\t * Returns a function that can be used to compare two\n\t * results, for sorting purposes. If no sorting should\n\t * be performed, `null` will be returned.\n\t *\n\t * @return function(a,b)\n\t */\n\tgetSortFunction(query:string, options:T.Options) {\n\t\tvar search  = this.prepareSearch(query, options);\n\t\treturn this._getSortFunction(search);\n\t}\n\n\t_getSortFunction(search:T.PrepareObj){\n\t\tvar i, n, implicit_score;\n\n\t\tconst self\t= this,\n\t\toptions\t\t= search.options,\n\t\tsort\t\t= (!search.query && options.sort_empty) ? options.sort_empty : options.sort,\n\t\tsort_flds:T.Sort[]\t\t= [],\n\t\tmultipliers:number[]\t= [];\n\n\n\t\t/**\n\t\t * Fetches the specified sort field value\n\t\t * from a search result item.\n\t\t *\n\t\t */\n\t\tconst get_field = function(name:string, result:T.ResultItem):string|number {\n\t\t\tif (name === '$score') return result.score;\n\t\t\treturn search.getAttrFn(self.items[result.id], name);\n\t\t};\n\n\t\t// parse options\n\t\tif (sort) {\n\t\t\tfor (i = 0, n = sort.length; i < n; i++) {\n\t\t\t\tif (search.query || sort[i].field !== '$score') {\n\t\t\t\t\tsort_flds.push(sort[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// the \"$score\" field is implied to be the primary\n\t\t// sort field, unless it's manually specified\n\t\tif (search.query) {\n\t\t\timplicit_score = true;\n\t\t\tfor (i = 0, n = sort_flds.length; i < n; i++) {\n\t\t\t\tif (sort_flds[i].field === '$score') {\n\t\t\t\t\timplicit_score = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (implicit_score) {\n\t\t\t\tsort_flds.unshift({field: '$score', direction: 'desc'});\n\t\t\t}\n\t\t} else {\n\t\t\tfor (i = 0, n = sort_flds.length; i < n; i++) {\n\t\t\t\tif (sort_flds[i].field === '$score') {\n\t\t\t\t\tsort_flds.splice(i, 1);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfor (i = 0, n = sort_flds.length; i < n; i++) {\n\t\t\tmultipliers.push(sort_flds[i].direction === 'desc' ? -1 : 1);\n\t\t}\n\n\t\t// build function\n\t\tconst sort_flds_count = sort_flds.length;\n\t\tif (!sort_flds_count) {\n\t\t\treturn null;\n\t\t} else if (sort_flds_count === 1) {\n\t\t\tconst sort_fld = sort_flds[0].field;\n\t\t\tconst multiplier = multipliers[0];\n\t\t\treturn function(a:T.ResultItem, b:T.ResultItem) {\n\t\t\t\treturn multiplier * cmp(\n\t\t\t\t\tget_field(sort_fld, a),\n\t\t\t\t\tget_field(sort_fld, b)\n\t\t\t\t);\n\t\t\t};\n\t\t} else {\n\t\t\treturn function(a:T.ResultItem, b:T.ResultItem) {\n\t\t\t\tvar i, result, field;\n\t\t\t\tfor (i = 0; i < sort_flds_count; i++) {\n\t\t\t\t\tfield = sort_flds[i].field;\n\t\t\t\t\tresult = multipliers[i] * cmp(\n\t\t\t\t\t\tget_field(field, a),\n\t\t\t\t\t\tget_field(field, b)\n\t\t\t\t\t);\n\t\t\t\t\tif (result) return result;\n\t\t\t\t}\n\t\t\t\treturn 0;\n\t\t\t};\n\t\t}\n\t};\n\n\t/**\n\t * Parses a search query and returns an object\n\t * with tokens and fields ready to be populated\n\t * with results.\n\t *\n\t */\n\tprepareSearch(query:string, optsUser:T.Options):T.PrepareObj {\n\t\tconst weights:T.Weights = {};\n\t\tvar options\t\t= Object.assign({},optsUser);\n\n\t\tpropToArray(options,'sort');\n\t\tpropToArray(options,'sort_empty');\n\n\t\t// convert fields to new format\n\t\tif( options.fields ){\n\t\t\tpropToArray(options,'fields');\n\t\t\tconst fields:T.Field[] = [];\n\t\t\toptions.fields.forEach((field:string|T.Field) => {\n\t\t\t\tif( typeof field == 'string' ){\n\t\t\t\t\tfield = {field:field,weight:1};\n\t\t\t\t}\n\t\t\t\tfields.push(field);\n\t\t\t\tweights[field.field] = ('weight' in field) ? field.weight : 1;\n\t\t\t});\n\t\t\toptions.fields = fields;\n\t\t}\n\n\n\t\treturn {\n\t\t\toptions\t\t: options,\n\t\t\tquery\t\t: query.toLowerCase().trim(),\n\t\t\ttokens\t\t: this.tokenize(query, options.respect_word_boundaries, weights),\n\t\t\ttotal\t\t: 0,\n\t\t\titems\t\t: [],\n\t\t\tweights\t\t: weights,\n\t\t\tgetAttrFn\t: (options.nesting) ? getAttrNesting : getAttr,\n\t\t};\n\t};\n\n\t/**\n\t * Searches through all items and returns a sorted array of matches.\n\t *\n\t */\n\tsearch(query:string, options:T.Options) : T.PrepareObj {\n\t\tvar self = this, score, search:T.PrepareObj;\n\n\t\tsearch  = this.prepareSearch(query, options);\n\t\toptions = search.options;\n\t\tquery   = search.query;\n\n\t\t// generate result scoring function\n\t\tconst fn_score = options.score || self._getScoreFunction(search);\n\n\t\t// perform search and sort\n\t\tif (query.length) {\n\t\t\titerate(self.items, (item:T.ResultItem, id:string|number) => {\n\t\t\t\tscore = fn_score(item);\n\t\t\t\tif (options.filter === false || score > 0) {\n\t\t\t\t\tsearch.items.push({'score': score, 'id': id});\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\titerate(self.items, (item:T.ResultItem, id:string|number) => {\n\t\t\t\tsearch.items.push({'score': 1, 'id': id});\n\t\t\t});\n\t\t}\n\n\t\tconst fn_sort = self._getSortFunction(search);\n\t\tif (fn_sort) search.items.sort(fn_sort);\n\n\t\t// apply limits\n\t\tsearch.total = search.items.length;\n\t\tif (typeof options.limit === 'number') {\n\t\t\tsearch.items = search.items.slice(0, options.limit);\n\t\t}\n\n\t\treturn search;\n\t};\n}\n"],"names":["latin_pat","accent_pat","accent_reg","RegExp","diacritic_patterns","latin_convert","convert_pat","Object","keys","join","code_points","asciifold","str","normalize","replace","toLowerCase","foreignletter","arrayToPattern","chars","glue","length","longest","forEach","a","Math","max","allSubstrings","input","result","substring","subresult","tmp","slice","charAt","push","unshift","generateDiacritics","diacritics","code_range","i","diacritic","String","fromCharCode","latin","patt","match","latin_chars","sort","b","substrings","pattern","map","sub_pat","l","hasOwnProperty","diacriticRegexPoints","regex","undefined","decomposed","split","part","no_accent","composed_part","getAttr","obj","name","getAttrNesting","names","shift","scoreValue","value","token","weight","score","pos","search","string","escape_regex","propToArray","key","Array","isArray","iterate","object","callback","cmp","Sifter","constructor","items","settings","tokenize","query","respect_word_boundaries","weights","tokens","words","field_regex","word","field_match","field","getScoreFunction","options","prepareSearch","_getScoreFunction","token_count","fields","field_count","getAttrFn","scoreObject","data","sum","conjunction","getSortFunction","_getSortFunction","n","implicit_score","self","sort_empty","sort_flds","multipliers","get_field","id","direction","splice","sort_flds_count","sort_fld","multiplier","optsUser","assign","trim","total","nesting","fn_score","item","filter","fn_sort","limit"],"mappings":"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"}